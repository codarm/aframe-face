<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="content-language" content="en-EN" />

    <title>Pledge Demo</title>

    <!-- INCLUDE JEELIZ FACEFILTER SCRIPT -->
    <script src="./dist/jeelizFaceFilter.js"></script>

    <!-- INCLUDE A MODIFIED VERSION OF AFRAME -->
    <!-- SEARCH FOR "JEELIZ" COMMENT TO SEE THE MODIFS -->
    <script src="./libs/aFrame/aframe-v0.8.2_modified.js">
      <script src="https://aframe.io/releases/0.9.2/aframe.min.js">
    </script>

    <style>
      body {
        font-family: Helvetica Neu, Arial, sans-serif;
      }
      #jeeFaceFilterCanvas {
        z-index: 0;
        max-height: 100%;
        left: auto;
        top: auto;
        width: 100vmin;
        transform: translate(0, 0) rotateY(180deg);
        position: relative;
      }

      .frameCanvas {
        z-index: 200;
        max-height: 200%;
        left: 0%;
        top: 0;
        width: 100vmin;
        transform: translate(0, 0) rotateY(0deg);
        position: relative;
        height: 200vh;
        pointer-events: none;
      }
    </style>

    <script>
      AFRAME.registerComponent("animate-png", {
        init: function() {
          // load the .pngs
          let loader = new THREE.TextureLoader();
          this.pngArray = [];
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F1.png?v=1614007100327"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F2.png?v=1614006909919"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F3.png?v=1614006911514"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F4.png?v=1614006915773"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F5.png?v=1614006919295"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F6.png?v=1614006926058"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F7.png?v=1614006930687"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F8.png?v=1614006935959"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F9.png?v=1614006939922"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F10.png?v=1614006944190"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F11.1.png?v=1614006950808"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F11.2.png?v=1614006953806"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F12.png?v=1614006958251"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F13.png?v=1614006970244"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F14.1.png?v=1614006970563"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F14.2.png?v=1614006972196"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F15.1.png?v=1614006976495"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F15.2.png?v=1614007015272"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F16.1.png?v=1614007018780"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F16.2.png?v=1614007018300"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F17.png?v=1614007030129"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F18.png?v=1614007032968"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F19.png?v=1614007047055"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2F20.png?v=1614007051968"
            )
          );

          this.el.addEventListener("loaded", e => {
            let mesh = this.el.getObject3D("mesh");
            this.material = mesh.material;

            var i = 0;
            this.id = setInterval(e => {
              if (i >= this.pngArray.length);
              this.material.map = this.pngArray[i++];
              this.material.needsUpdate = true;
            }, 4000);
          });
        },
        remove: function() {
          clearInterval(this.id);
          // free the memory
          for (let i = 0; i < this.pngArray.length; i++) {
            this.pngArray[i].dispose();
          }
        }
        //entity.emit('animate-png', null, true);
      });
    </script>

    <!-- INCLUDE DEMO SCRIPT -->
    <script src="./main.js"></script>

    <!-- INCLUDE FORK ME ON GITHUB BANNER -->
    <!script src="./appearance/widget.js">
    <!/script>

    <link rel="stylesheet" href="./appearance/style.css" type="text/css" />
  </head>

  <body onload="main()">
    <canvas width="600" height="600" id="jeeFaceFilterCanvas"></canvas>
    <canvas width="600" height="600" id="frameCanvas" class="FrameCanvas">
    </canvas>

    <canvas width="1200" height="1200" id="canvasVideoEffect"></canvas>

    <!-- BEGIN OF A-FRAME SCENE -->
    <!-- All objects with the ID jeelizFaceFilterFollow will follow the head -->
    <a-scene embedded>
      <a-assets>
        <a-asset-item
          id="mask"
          position="0 0 0"
          src="https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2Fout%20(2).glb?v=1613993807055"
          response-type="arraybuffer"
        >
        </a-asset-item>
        <a-mixin
          id="text"
          text="align: center; width: 2;
			       value: Hello World!"
        ></a-mixin>
      </a-assets>

      <a-plane
        id="jeelizFaceFilterFollow"
        position="0.5 3.25 -5"
        rotation="0 0 0"
        width="3"
        height="1.5"
        depth="1"
        color="#FFFFFF"
        animate-png
      >
        <!a-image src="https://cdn.glitch.com/3f35993f-6c9d-4b3e-a61d-17e740d68d9b%2Fmask%402x.png?v=1613996146160" position="0 -3.0 -4" scale="3.0 3.0 3.0">
        <!/a-image>

        <!script>entity.emit('animate-png', null, true);<!/script>
        <a-entity
          position="0 -3 -5"
          scale="0.8 0.8 0.8"
          gltf-model="#mask"
          animation-mixer
        ></a-entity>
      </a-plane>

      <a-plane
        position="0 0 -4"
        rotation="-90 0 0"
        width="4"
        height="4"
        color="#7BC8A4"
      ></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
    <!-- END OF A-FRAME SCENE -->
  </body>
</html>
